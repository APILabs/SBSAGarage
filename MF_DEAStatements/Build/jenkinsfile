pipeline {
    agent any
    stages
     {
        stage('pull from git')
        {
        	steps {
            	checkout([
                       $class: 'GitSCM',
                       branches: [[name: '*/master']],
                       extensions: scm.extensions + [[$class: 'LocalBranch'], [$class: 'WipeWorkspace']],
                       userRemoteConfigs: [[credentialsId: 'githubcredid', url: 'https://github.com/APILabs/SBSAGarage.git']],
                      
               		])
               	}
        }
        stage('Build Ant')
        {
        	steps {
            	withAnt(installation: 'antlocal') 
				{
					sh "ant -buildfile ./MF_DEAStatements/Build/build2.xml"
				}
           	 }
				
        }
        stage('Set Docker Env') 
        {
                steps {
                    echo 'Starting to build docker image'
                    script {
                        def dockerfile = 'dockerfile.ace_dea'
                        def customImage = docker.build("ace_dea:${env.BUILD_ID}", "-f ./MF_DEAStatements/Build/${dockerfile} ./MF_DEAStatements")           
                        }
                    }
        }
	stage('Push image to OC') 
        {
                steps {
                    echo 'Tag the image and push to OC'
                    sh """
			oc login https://masterdnskoqhav52vva4i.westeurope.cloudapp.azure.com:443 --insecure-skip-tls-verify -u Developer1 -p Developer1
                        // login to docker registry on openshift cluster
			docker login -u $(oc whoami) -p $(oc whoami -t) docker-registry-default.40.68.250.242.nip.io
                        
                        
                    """
                    }
        }
    }
}
